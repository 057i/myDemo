var list,len,$=window.Zepto,root=window.player,nowIndex=0,audioPlayer=new root.audioControl,rotateDom=new root.rotateAlbum($(".img-box"));function bingEvent(e){$(".control").on("click",".pre",function(){0==nowIndex?nowIndex=len-1:nowIndex--;var o=audioPlayer.audio.status;root.render(e[nowIndex]),audioPlayer.setSource(e[nowIndex].audio),audioPlayer.audio.status=o,"play"==audioPlayer.audio.status&&(audioPlayer.audio.status="continue",$(".play").click()),rotateDom.change(),root.pro.renderAllTime(e[nowIndex].duration),root.renderList(e,nowIndex)}).on("click",".play",function(){"play"==audioPlayer.audio.status?(audioPlayer.pause(),rotateDom.stop(),root.pro.stop()):"pause"==audioPlayer.audio.status?(audioPlayer.play(),rotateDom.con(),root.pro.start()):"continue"==audioPlayer.audio.status&&(audioPlayer.audio.status="play",audioPlayer.play(),rotateDom.stop(),rotateDom.num=0,rotateDom.change(),rotateDom.con(),root.pro.stop()),"play"==audioPlayer.audio.status?$(".play").addClass("pause"):$(".play").removeClass("pause")}).on("click",".next",function(){nowIndex==len-1?nowIndex=0:nowIndex++;var o=audioPlayer.audio.status;root.render(e[nowIndex]),audioPlayer.setSource(e[nowIndex].audio),audioPlayer.audio.status=o,"play"==audioPlayer.audio.status&&(audioPlayer.audio.status="continue",$(".play").click()),root.pro.renderAllTime(e[nowIndex].duration),root.renderList(e,nowIndex),root.pro.reset(),rotateDom.change()}),$(".list").on("click",function(){$(".listWrapper").hasClass("listActive")?$(".listWrapper").removeClass("listActive"):$(".listWrapper").addClass("listActive")}),$(".btn,.like").on("click",function(){$(".btn,.like").hasClass("liking")?$(".btn,.like").removeClass("liking"):$(".btn,.like").addClass("liking")}),$(".listWrapper,li").on("click",function(o){nowIndex=$(o.target).index();var a=audioPlayer.audio.status;root.render(e[nowIndex]),audioPlayer.setSource(e[nowIndex].audio),audioPlayer.audio.status=a,root.renderList(e,nowIndex)})}function proControl(){var r,o=$(".total-progress").offset(),n=o.left,i=o.width;$("#spot").on("touchstart",function(o){r=audioPlayer.audio.status,console.log(audioPlayer.audio.status,"状态"),$(".control").trigger("click"),root.pro.stop(),audioPlayer.pause()}).on("touchmove",function(o){var a=(o.changedTouches[0].clientX-n)/i;0<=a&&a<1&&root.pro.update(a)}),$("#spot").on("touchend",function(o){var a=(o.changedTouches[0].clientX-n)/i;if(0<=a&&a<1){var e=list[nowIndex].duration,t=Math.round(e*a);audioPlayer.playTo(t),console.log("dragAudioFlag",r,a),root.pro.changePreTime(a*audioPlayer.audio.duration),console.log(a,audioPlayer.audio.duration,"******"),console.log("拖动时间",root.pro),audioPlayer.playTo(a*audioPlayer.audio.duration),console.log(r),"play"==r?(console.log("继续播放",a),audioPlayer.status=r,root.pro.start(a*audioPlayer.audio.duration),audioPlayer.play()):(console.log("暂停"),audioPlayer.status=r)}})}function getDate(o){$.ajax({type:"GET",url:o,success:function(o){bingEvent(o),proControl(),len=(list=o).length,root.render(o[0]),audioPlayer.setSource(o[nowIndex].audio),root.pro.renderAllTime(o[nowIndex].duration),root.renderList(o,0)},error:function(){console.log("error")}})}getDate("../mook/data.json");